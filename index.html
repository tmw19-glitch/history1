<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日本史B 社会経済史・正誤問題マスター</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 基本フォント設定 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        
        /* アニメーション用クラス */
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-stone-100 min-h-screen text-slate-800">

    <!-- アプリケーションのマウントポイント -->
    <div id="app" class="p-4 md:p-8 max-w-3xl mx-auto"></div>

    <script>
        // --- 1. アイコン定義 (SVG文字列を返す関数) ---
        const Icons = {
            CheckCircle: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>`,
            XCircle: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>`,
            AlertTriangle: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>`,
            BookOpen: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>`,
            RefreshCw: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <polyline points="1 20 1 14 7 14"></polyline>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>`,
            Lightbulb: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="9" y1="18" x2="15" y2="18"></line>
                    <line x1="10" y1="22" x2="14" y2="22"></line>
                    <path d="M15.09 14c.18-.9.93-1.54 1.86-1.54a.7.7 0 0 0 .5-.19l.12-.13c1.7-1.87 1.4-4.9-1-6.14a7.1 7.1 0 0 0-9.14 0c-2.4 1.24-2.7 4.27-1 6.14l.12.13a.7.7 0 0 0 .5.19c.93 0 1.68.64 1.86 1.54"></path>
                </svg>`,
            GraduationCap: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                    <path d="M6 12v5c3 0 6-1 6-1v-4"></path>
                </svg>`,
            ArrowRight: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                </svg>`,
            ChevronDown: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>`,
            Refresh: () => `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <polyline points="1 20 1 14 7 14"></polyline>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>`
        };

        // --- 2. データ定義 (全20問) ---
        const ALL_QUESTIONS_DATA = [
            {
                id: 1,
                title: "弥生時代の遺跡・遺物",
                source: "12 追試",
                category: "古代",
                questionText: "弥生時代の遺跡や遺物には戦争とのかかわりを示すものが見られるが，そのことに関して述べた文として正しいものを一つ選べ。",
                options: [
                    { id: 1, text: "北陸から東北にかけての沿岸部に，朝鮮式山城が築かれた。", isCorrect: false, explanation: "朝鮮式山城は飛鳥時代（白村江の戦い後）に西日本に築かれました。", correction: "「飛鳥時代」に「西日本」に築かれた。", relatedInfo: "【防御施設】弥生時代には高地性集落などが、古墳・飛鳥時代には山城が築かれました。" },
                    { id: 2, text: "石鏃（せきぞく）は，弥生時代以後，武器として用いられなかった。", isCorrect: false, explanation: "石鏃は金属器伝来後も、弥生時代を通じて武器として使用されました。", correction: "弥生時代を通じて「用いられた」。", relatedInfo: "【石器の終焉】実用的な石器が完全に姿を消すのは、古墳時代中期以降です。" },
                    { id: 3, text: "周囲に濠（ほり）や土塁をめぐらす集落が現れた。", isCorrect: true, explanation: "正しい。戦乱に備えた環濠集落（吉野ヶ里遺跡など）が出現しました。", correction: null, relatedInfo: "【重要用語】環濠集落＝防御的集落。佐賀県の吉野ヶ里遺跡が最大級です。" },
                    { id: 4, text: "銅剣・銅矛・銅戈は，本来，祭器として製作された。", isCorrect: false, explanation: "大陸では実用武器でしたが、日本で祭器化しました。", correction: "大陸では「実用武器」だった。", relatedInfo: "【青銅器の分布】平形銅剣は瀬戸内、銅鐸は近畿、銅矛は九州北部に多く分布します。" }
                ]
            },
            {
                id: 2,
                title: "鎌倉時代の経済",
                source: "09 追試",
                category: "中世",
                questionText: "鎌倉時代の社会や経済の動向について述べた文として正しいものを一つ選べ。",
                options: [
                    { id: 1, text: "鎌倉幕府は，貨幣を入手するために元に天龍寺船を送った。", isCorrect: false, explanation: "天龍寺船は室町幕府（足利尊氏）が派遣しました。", correction: "「室町幕府」が派遣した。", relatedInfo: "【貿易船】鎌倉＝日宋貿易、室町＝天龍寺船・日明貿易（勘合貿易）、安土桃山＝朱印船貿易。" },
                    { id: 2, text: "遠隔地の取引を決済するために，為替が用いられるようになった。", isCorrect: true, explanation: "正しい。銭貨輸送のリスク回避のため為替（割符）が普及しました。", correction: null, relatedInfo: "【金融】年貢の銭納化が進むにつれ、遠隔地送金手段としての為替が必要とされました。" },
                    { id: 3, text: "農民は徳政を要求して，しばしば幕府への大規模な実力行使を起こした。", isCorrect: false, explanation: "農民による徳政要求（土一揆）は室町時代の特徴です。", correction: "「室町時代」のこと。", relatedInfo: "【一揆】正長の土一揆（1428年）などが有名です。鎌倉時代の徳政令は御家人救済が目的でした。" },
                    { id: 4, text: "鎌倉幕府は，しばしば撰銭令を出して貨幣の流通を統制しようとした。", isCorrect: false, explanation: "撰銭令は室町幕府や戦国大名によって出されました。", correction: "「室町幕府」が出した。", relatedInfo: "【貨幣】鎌倉時代は宋銭が流通しましたが、撰銭（悪銭嫌い）が問題化するのは室町時代以降です。" }
                ]
            },
            {
                id: 3,
                title: "律令制下の土地制度",
                source: "オリジナル",
                category: "古代",
                questionText: "奈良時代の土地制度や農業について述べた文として誤っているものを一つ選べ。",
                options: [
                    { id: 1, text: "口分田は、6歳以上の男女に班給され、死ねば国に返還された。", isCorrect: false, explanation: "正しい記述です。班田収授法の基本原則です。", correction: null, relatedInfo: "【班田収授法】6年ごとの戸籍作成に基づいて行われました。" },
                    { id: 2, text: "墾田永年私財法により、開墾した土地の永代私有が認められた。", isCorrect: false, explanation: "正しい記述です。743年に出され、これが荘園発生の契機となりました。", correction: null, relatedInfo: "【土地私有】百万町歩開墾計画 → 三世一身法 → 墾田永年私財法と推移しました。" },
                    { id: 3, text: "条里制によって、耕地が整然と区画された。", isCorrect: false, explanation: "正しい記述です。土地区画制度として実施されました。", correction: null, relatedInfo: "【条里制】約109m四方の「坪」に区画し、地番をつけて管理しました。" },
                    { id: 4, text: "全国的に二毛作が普及し、麦が裏作として栽培された。", isCorrect: true, explanation: "誤りです。二毛作が普及し始めるのは「鎌倉時代」以降（畿内・西国中心）です。", correction: "二毛作の普及は「鎌倉時代」以降。", relatedInfo: "【農業史】鎌倉＝二毛作（西日本）、室町＝三毛作も見られる、江戸＝千歯こき等の農具発達。" }
                ]
            },
            {
                id: 4,
                title: "室町時代の産業と経済",
                source: "オリジナル",
                category: "中世",
                questionText: "室町時代の産業・経済について述べた文として正しいものを一つ選べ。",
                options: [
                    { id: 1, text: "定期市は、月に3回開かれる三斎市が一般的になった。", isCorrect: false, explanation: "室町時代には、月に6回開かれる「六斎市」が一般的になりました。", correction: "「六斎市」が一般的になった。", relatedInfo: "【定期市】鎌倉時代は三斎市が中心でした。" },
                    { id: 2, text: "馬借や車借と呼ばれる運送業者が活躍した。", isCorrect: true, explanation: "正しい。陸上の運送業者として馬借・車借が、水上では問丸などが活躍しました。", correction: null, relatedInfo: "【流通】彼らは土一揆の主力ともなり、徳政を要求しました。" },
                    { id: 3, text: "明銭の輸入が途絶え、国内での貨幣鋳造が本格化した。", isCorrect: false, explanation: "室町時代は日明貿易により「永楽通宝」などの明銭が大量に輸入され流通しました。国内鋳造は行われていません。", correction: "明銭が「大量に輸入」された。", relatedInfo: "【貨幣】国内鋳造（寛永通宝など）が本格化するのは江戸時代からです。" },
                    { id: 4, text: "座と呼ばれる同業組合が、織田信長によって保護された。", isCorrect: false, explanation: "織田信長は「楽市・楽座」を行い、座の特権を廃止しました。", correction: "信長によって「廃止（解体）」された。", relatedInfo: "【座】公家や寺社を本所として特権を得ていた同業組合です。" }
                ]
            },
            {
                id: 5,
                title: "江戸時代の農業技術",
                source: "オリジナル",
                category: "近世",
                questionText: "江戸時代の農業技術の発展について述べた文として誤っているものを一つ選べ。",
                options: [
                    { id: 1, text: "深耕に適した備中ぐわが普及した。", isCorrect: false, explanation: "正しい。備中ぐわの使用により土地を深く耕すことが可能になりました。", correction: null, relatedInfo: "【農具】深耕は根の張りを良くし、収穫量を増やす基本技術でした。" },
                    { id: 2, text: "脱穀用具として千歯こきが発明された。", isCorrect: false, explanation: "正しい。こき箸に比べて能率が飛躍的に向上し、「後家倒し」とも呼ばれました。", correction: null, relatedInfo: "【農具】元禄時代頃に普及し、脱穀作業の効率化に大きく貢献しました。" },
                    { id: 3, text: "商品作物として、四木（桑・漆・茶・楮）三草（麻・紅花・藍）が栽培された。", isCorrect: false, explanation: "正しい。換金作物の栽培が盛んになりました。", correction: null, relatedInfo: "【産業】綿花・菜種なども代表的な商品作物として栽培されました。" },
                    { id: 4, text: "金肥として、化学肥料が全国的に使用されるようになった。", isCorrect: true, explanation: "誤りです。江戸時代の金肥（購入肥料）は「干鰯（ほしか）」や「油粕」です。化学肥料の登場は明治以降です。", correction: "金肥は「干鰯」や「油粕」など。", relatedInfo: "【肥料史】自給肥料（刈敷・草木灰）→金肥（干鰯・油粕）→化学肥料（明治以降）。" }
                ]
            },
            {
                id: 6,
                title: "江戸時代の三貨制度",
                source: "オリジナル",
                category: "近世",
                questionText: "江戸時代の貨幣制度について述べた文として正しいものを一つ選べ。",
                options: [
                    { id: 1, text: "金・銀・銭の三貨が統一的に全国で使用され、交換比率は固定されていた。", isCorrect: false, explanation: "三貨の交換比率は相場により変動しました（変動相場制）。また、東日本は金、西日本は銀遣いという傾向がありました。", correction: "交換比率は「変動」した。", relatedInfo: "【両替商】本両替（金銀両替）と銭両替があり、金融の中心となりました。" },
                    { id: 2, text: "藩札は、幕府が全国の藩に発行を強制した紙幣である。", isCorrect: false, explanation: "藩札は、各藩が領内の通貨不足を補うため、幕府の許可を得て独自に発行したものです。", correction: "各藩が「独自」に発行した。", relatedInfo: "【藩札】福井藩で最初に発行されたと言われています。" },
                    { id: 3, text: "計数貨幣の金・銭と、秤量貨幣の銀が併用された。", isCorrect: true, explanation: "正しい。金（小判）と銭は枚数で数える計数貨幣、銀（丁銀）は重さを量る秤量貨幣でした。", correction: null, relatedInfo: "【貨幣】丁銀や豆板銀は、天秤で重さを測って使用しました。" },
                    { id: 4, text: "元禄小判は、慶長小判よりも金の含有率が高められた。", isCorrect: false, explanation: "元禄小判は、財政難補填のため慶長小判より金の含有率を「下げて（改悪）」発行されました（荻原重秀の献策）。", correction: "含有率が「下げられた」。", relatedInfo: "【改鋳】これが貨幣価値の下落とインフレ（物価騰貴）を招きました。" }
                ]
            },
            {
                id: 7,
                title: "地租改正",
                source: "オリジナル",
                category: "近現代",
                questionText: "明治政府が行った地租改正（1873年〜）について述べた文として正しいものを一つ選べ。",
                options: [
                    { id: 1, text: "課税の基準を、収穫高から地価に変更した。", isCorrect: true, explanation: "正しい。豊凶により変動する収穫高基準から、一定の地価基準へ変更し、税収の安定を図りました。", correction: null, relatedInfo: "【三大原則】地価基準、金納、地価の3%。" },
                    { id: 2, text: "地租の税率は、当初地価の10%とされた。", isCorrect: false, explanation: "当初の税率は「3%」です。後の地租改正反対一揆により2.5%に引き下げられました。", correction: "税率は「3%」。", relatedInfo: "【反対運動】伊勢暴動や真壁騒動などの地租改正反対一揆が頻発しました。" },
                    { id: 3, text: "税の納入方法は、米納を原則とした。", isCorrect: false, explanation: "地租改正により、現物納（米）から「金納（現金払い）」に改められました。", correction: "「金納」を原則とした。", relatedInfo: "【財政】金納化により、政府の歳入が安定し、近代化政策の財源となりました。" },
                    { id: 4, text: "地券は、江戸時代の名主に交付された。", isCorrect: false, explanation: "地券は、土地の所有者（地主・自作農）に交付され、彼らが納税義務者となりました。", correction: "「土地所有者」に交付された。", relatedInfo: "【地券】地価・地租・所有者などが記載され、土地所有権の確認証となりました。" }
                ]
            },
            {
                id: 8,
                title: "松方財政とデフレ",
                source: "オリジナル",
                category: "近現代",
                questionText: "1880年代前半の松方財政について述べた文として誤っているものを一つ選べ。",
                options: [
                    { id: 1, text: "大蔵卿の松方正義が、インフレーションの収束を目指して緊縮財政を行った。", isCorrect: false, explanation: "正しい記述です。西南戦争後のインフレを鎮静化させました。", correction: null, relatedInfo: "【財政】紙幣整理を行い、歳出削減と増税（酒造税など）を実施しました。" },
                    { id: 2, text: "日本銀行を設立し、銀本位制に基づく紙幣発行制度を整えた。", isCorrect: false, explanation: "正しい記述です。1882年に日本銀行を設立し、不換紙幣を回収して兌換制度（銀本位）を確立しました。", correction: null, relatedInfo: "【金融】日本銀行はベルギー国立銀行をモデルに設立されました。" },
                    { id: 3, text: "米価が暴落し、多くの農民が土地を失って小作農へと転落した。", isCorrect: false, explanation: "正しい記述です。深刻なデフレ（松方デフレ）により農村は困窮し、寄生地主制の拡大につながりました。", correction: null, relatedInfo: "【農村】困窮した農民は、秩父事件などの激化事件を起こしました。" },
                    { id: 4, text: "官営模範工場の払い下げを中止し、国営化を推進した。", isCorrect: true, explanation: "誤りです。松方財政期に「官営工場の払い下げ」に関する法律（官営工場払下概則の廃止→適正化）ができ、政商などへの払い下げが進みました。", correction: "払い下げを「推進」した。", relatedInfo: "【払い下げ】富岡製糸場（三井へ）や長崎造船所（三菱へ）などが有名です。" }
                ]
            },
            {
                id: 9,
                title: "明治時代の産業革命（軽工業）",
                source: "オリジナル",
                category: "近現代",
                questionText: "明治時代の製糸業と紡績業について述べた文として正しいものを一つ選べ。",
                options: [
                    { id: 1, text: "製糸業は、国内向けの綿花を原料とした。", isCorrect: false, explanation: "製糸業は「蚕の繭（生糸）」を原料とします。綿花は紡績業です。", correction: "製糸業は「生糸（繭）」が原料。", relatedInfo: "【用語注意】製糸（シルク・輸出用）と紡績（コットン・国内消費→輸出）を区別しましょう。" },
                    { id: 2, text: "ガラ紡は、欧米から輸入された最新の紡績機械である。", isCorrect: false, explanation: "ガラ紡は、臥雲辰致（がうんたっち）が発明した「国産」の簡易紡績機です。", correction: "「国産」の簡易紡績機。", relatedInfo: "【技術】第一回内国勧業博覧会で受賞しましたが、大規模機械紡績に押され衰退しました。" },
                    { id: 3, text: "生糸は、明治時代を通じて日本の最大の輸出品であった。", isCorrect: true, explanation: "正しい。生糸は外貨獲得の主力商品で、主にアメリカへ輸出されました。", correction: null, relatedInfo: "【貿易】生糸の輸出により得た外貨で、重工業化に必要な機械などを輸入しました。" },
                    { id: 4, text: "座繰製糸は、器械製糸よりも生産効率が高かった。", isCorrect: false, explanation: "座繰（ざぐり）は手動、器械製糸は動力です。1894年に器械製糸の生産量が座繰製糸を上回りました。", correction: "器械製糸の方が「効率が高い」。", relatedInfo: "【産業転換】1894年（日清戦争開始年）に器械製糸の生産高が座繰製糸を上回りました。" }
                ]
            },
            {
                id: 10,
                title: "明治・大正期の重工業",
                source: "オリジナル",
                category: "近現代",
                questionText: "日本の重工業の発展について述べた文として正しいものを一つ選べ。",
                options: [
                    { id: 1, text: "官営八幡製鉄所は、日露戦争の賠償金を元手に設立された。", isCorrect: false, explanation: "八幡製鉄所は「日清戦争」の賠償金を一部流用して設立され、1901年に操業開始しました。", correction: "「日清戦争」の賠償金。", relatedInfo: "【鉄鋼業】鉄鉱石は中国の大冶鉄山から、石炭は筑豊炭田から調達しました。" },
                    { id: 2, text: "日本製鋼所は、民間企業の出資により設立された。", isCorrect: true, explanation: "正しい。北海道炭礦汽船と英国企業（アームストロング社など）の合弁で設立されました。", correction: null, relatedInfo: "【重工業】室蘭に設立され、艦砲や装甲板などの兵器用鋼材を製造しました。" },
                    { id: 3, text: "1900年代には、重化学工業の生産額が軽工業を上回っていた。", isCorrect: false, explanation: "重化学工業が軽工業を上回るのは「1930年代」です。", correction: "上回ったのは「1930年代」。", relatedInfo: "【産業構造】1930年代の重化学工業化は、満州事変以降の軍需拡大が背景です。" },
                    { id: 4, text: "造船業は、第一次世界大戦による不況で大打撃を受けた。", isCorrect: false, explanation: "第一次世界大戦中は「船成金」が出るほどの好況（大戦景気）でした。世界的な船舶不足が背景です。", correction: "大戦景気で「発展」した。", relatedInfo: "【大戦景気】世界的な船腹不足により、海運業・造船業が空前の活況を呈しました。" }
                ]
            },
            {
                id: 11,
                title: "大戦景気と社会",
                source: "オリジナル",
                category: "近現代",
                questionText: "第一次世界大戦中の日本経済（大戦景気）について述べた文として誤っているものを一つ選べ。",
                options: [
                    { id: 1, text: "ヨーロッパ列強のアジア市場後退により、日本の輸出が急増した。", isCorrect: false, explanation: "正しい記述です。綿製品などをアジア市場へ独占的に輸出しました。", correction: null, relatedInfo: "【貿易】輸出超過が続き、日本は莫大な利益を上げました。" },
                    { id: 2, text: "日本は債務国から債権国へと転換した。", isCorrect: false, explanation: "正しい記述です。輸出超過により多額の外貨を得て、債権国となりました。", correction: null, relatedInfo: "【社会】成金と呼ばれる富裕層が登場する一方、物価高騰で一般庶民の生活は苦しくなりました（米騒動へ）。" },
                    { id: 3, text: "大戦景気の反動で、戦後恐慌が発生した。", isCorrect: false, explanation: "正しい記述です。1920年に株価暴落により戦後恐慌が起きました。", correction: null, relatedInfo: "【不況】1920年代は、戦後恐慌・震災恐慌・金融恐慌と慢性的な不況が続きました。" },
                    { id: 4, text: "工業生産額が農業生産額を大きく下回るようになった。", isCorrect: true, explanation: "誤りです。大戦景気の最中（1918年頃）、工業生産額が農業生産額を「上回る」ようになり、工業国化が進みました。", correction: "工業生産額が「上回る」ようになった。", relatedInfo: "【転換点】農業国から工業国へ転換し、都市部の人口も増加しました。" }
                ]
            },
            {
                id: 12,
                title: "昭和恐慌",
                source: "オリジナル",
                category: "近現代",
                questionText: "1930年頃の昭和恐慌について述べた文として正しいものを一つ選べ。",
                options: [
                    { id: 1, text: "浜口雄幸内閣は、金解禁（金輸出解禁）を断行した。", isCorrect: true, explanation: "正しい。井上準之助蔵相のもと、旧平価での金解禁を行いましたが、世界恐慌と重なり大不況となりました。", correction: null, relatedInfo: "【政策】産業合理化と国際競争力強化を目指しましたが、デフレ圧力を招き裏目に出ました。" },
                    { id: 2, text: "アメリカへの生糸輸出が急増し、農村は潤った。", isCorrect: false, explanation: "世界恐慌でアメリカの景気が悪化し、贅沢品である生糸の輸出が激減。農村は「豊作貧乏」など深刻な打撃を受けました。", correction: "輸出が「激減」し困窮した。", relatedInfo: "【社会問題】娘の身売りや欠食児童が深刻化し、農村の疲弊が進みました。" },
                    { id: 3, text: "重要産業統制法により、カルテルの結成が禁止された。", isCorrect: false, explanation: "不況対策として、逆にカルテル結成を「助長・容認」して産業の合理化を図りました。", correction: "カルテル結成を「助長」した。", relatedInfo: "【産業統制】これは独占資本を保護・強化する側面がありました。" },
                    { id: 4, text: "高橋是清蔵相は、緊縮財政政策をとった。", isCorrect: false, explanation: "犬養毅内閣の高橋是清は、金輸出再禁止を行い、「積極財政（管理通貨制度）」へ転換して景気回復を図りました。", correction: "「積極財政」をとった。", relatedInfo: "【財政】日銀による赤字国債引受を行い、インフレ懸念もありましたが景気を回復させました。" }
                ]
            },
            {
                id: 13,
                title: "戦時下の経済統制",
                source: "オリジナル",
                category: "近現代",
                questionText: "日中戦争以降の戦時経済統制について述べた文として誤っているものを一つ選べ。",
                options: [
                    { id: 1, text: "国家総動員法により、議会の承認なしに勅令で物資や労働力を動員できるようになった。", isCorrect: false, explanation: "正しい記述です。1938年に制定されました。", correction: null, relatedInfo: "【法制】第1次近衛文麿内閣の時に成立しました。" },
                    { id: 2, text: "切符制や配給制が導入され、国民生活は厳しく制限された。", isCorrect: false, explanation: "正しい記述です。砂糖、マッチ、米などが統制されました。", correction: null, relatedInfo: "【スローガン】「贅沢は敵だ」「欲しがりません勝つまでは」などが掲げられました。" },
                    { id: 3, text: "国民徴用令により、多くの一般国民が軍需工場などに動員された。", isCorrect: false, explanation: "正しい記述です。労働力不足を補うため実施されました。", correction: null, relatedInfo: "【労働】勤労報国隊や女子挺身隊なども組織されました。" },
                    { id: 4, text: "寄生地主制を強化するため、小作料の引き上げが行われた。", isCorrect: true, explanation: "誤りです。食糧増産確保のため、政府は地主よりも生産者（小作農）を保護する政策（小作料統制令など）をとりました。これは戦後の地主制解体への伏線となります。", correction: "小作料は「統制（引き下げ）」された。", relatedInfo: "【農村】戦時体制下では、地主の影響力が相対的に低下しました。" }
                ]
            },
            {
                id: 14,
                title: "戦後改革と経済復興",
                source: "オリジナル",
                category: "現代",
                questionText: "第二次世界大戦後の経済民主化政策について述べた文として正しいものを一つ選べ。",
                options: [
                    { id: 1, text: "農地改革により、不在地主の貸付地はすべて小作人に売り渡された。", isCorrect: true, explanation: "正しい。寄生地主制が解体され、多くの自作農が生まれました。", correction: null, relatedInfo: "【農地改革】第2次改革で徹底され、小作地の割合が激減しました。" },
                    { id: 2, text: "財閥解体は、GHQの指令ではなく日本政府が自発的に行った。", isCorrect: false, explanation: "GHQの指令により実施されました。持株会社整理委員会などが設置されました。", correction: "「GHQの指令」による。", relatedInfo: "【経済民主化】4大財閥（三井・三菱・住友・安田）などが解体対象となりました。" },
                    { id: 3, text: "労働組合法により、労働者の団結権が制限された。", isCorrect: false, explanation: "労働組合法は労働者の権利を「保障」するものです。団結権・団体交渉権・争議権。", correction: "団結権が「保障」された。", relatedInfo: "【労働三法】労組法、労調法、労基法。労働運動が活発化しました。" },
                    { id: 4, text: "ドッジ＝ラインにより、超インフレが発生した。", isCorrect: false, explanation: "ドッジ＝ラインはインフレ収束のための「超均衡予算（緊縮財政）」です。これによりインフレは収束しましたが、安定恐慌が起きました。", correction: "インフレを「収束」させた。", relatedInfo: "【為替】1ドル＝360円の単一為替レートが設定されました。" }
                ]
            },
            {
                id: 15,
                title: "高度経済成長",
                source: "オリジナル",
                category: "現代",
                questionText: "1960年代の高度経済成長期について述べた文として誤っているものを一つ選べ。",
                options: [
                    { id: 1, text: "池田勇人内閣は、所得倍増計画を掲げた。", isCorrect: false, explanation: "正しい記述です。10年間で国民所得を倍増させる目標を立てました。", correction: null, relatedInfo: "【政策】「寛容と忍耐」を掲げ、経済中心の国づくりを進めました。" },
                    { id: 2, text: "エネルギー革命により、主要エネルギーが石炭から石油へ転換した。", isCorrect: false, explanation: "正しい記述です。これにより炭鉱業は衰退しましたが、コンビナートなどが発展しました。", correction: null, relatedInfo: "【社会問題】三池炭鉱争議（1960年）は、このエネルギー転換期の象徴的な出来事です。" },
                    { id: 3, text: "三種の神器（カラーテレビ・クーラー・自動車）が普及した。", isCorrect: true, explanation: "誤りです。三種の神器は「白黒テレビ・洗濯機・冷蔵庫」（1950年代後半）。カラーテレビ・クーラー・自動車（3C）は「新・三種の神器」（1960年代後半）です。", correction: "それは「新・三種の神器」。", relatedInfo: "【消費】大量生産・大量消費社会が到来しました。" },
                    { id: 4, text: "東海道新幹線が開通し、オリンピック東京大会が開催された。", isCorrect: false, explanation: "正しい記述です。1964年のことです。", correction: null, relatedInfo: "【国際化】OECD（経済協力開発機構）への加盟もこの年です。" }
                ]
            },
            // --- ここからは既存の問題（IDを連番に変更） ---
            {
                id: 16,
                title: "綿糸の生産と輸出入（明治時代）",
                source: "10 追試",
                category: "近現代",
                questionText: "【グラフ読み取り】紡績業に関して述べた文として正しい組合せを選べ。\na: 松方財政以前から，綿糸生産は輸入を上回っていた。\nb: 日清戦争後，綿糸輸出が急増した。\nc: 日露戦争後，綿糸生産は増加傾向にあった。\nd: 関税自主権回復に伴い，綿糸輸出が輸入を上回るようになった。",
                options: [
                    { id: 1, text: "a・c", isCorrect: false, explanation: "aが誤り。", correction: "a:生産＞輸入は1890年。", relatedInfo: "a: 大阪紡績会社の成功（1883年）が転機です。" },
                    { id: 2, text: "a・d", isCorrect: false, explanation: "aとdが誤り。", correction: "d:輸出＞輸入は1897年。", relatedInfo: "d: 輸出が輸入を上回るのは、日清戦争後の1897年頃です。" },
                    { id: 3, text: "b・c", isCorrect: true, explanation: "正しい。日清戦争後に輸出急増、日露後も生産増加。", correction: null, relatedInfo: "1890年：生産＞輸入、1897年：輸出＞輸入。この順序が重要です。" },
                    { id: 4, text: "b・d", isCorrect: false, explanation: "dが誤り。", correction: "d:関税自主権回復(1911)より前。", relatedInfo: "d: 関税自主権回復は1911年で、紡績業の発展より後の出来事です。" }
                ]
            },
            {
                id: 17,
                title: "1910年代の工業の発展（大正時代）",
                source: "オリジナル・改題",
                category: "近現代",
                questionText: "第一次世界大戦による好景気に関連して，1910年代の工業について述べた文として正しいものを選べ。",
                options: [
                    { id: 1, text: "猪苗代水力発電所から東京への長距離送電が成功した。", isCorrect: true, explanation: "正しい。1914年の成功により動力革命が進展しました。", correction: null, relatedInfo: "【電力】水力発電の普及により、工場の動力が蒸気から電力へ転換しました。" },
                    { id: 2, text: "重化学工業の生産額が，軽工業の生産額を上回った。", isCorrect: false, explanation: "重化学＞軽工業は1930年代です。", correction: "「1930年代」のこと。", relatedInfo: "1910年代は工業生産額＞農業生産額（1918年頃）がポイントです。" },
                    { id: 3, text: "官営八幡製鉄所が設立され，操業を開始した。", isCorrect: false, explanation: "操業開始は1901年です。", correction: "「1901年」に開始。", relatedInfo: "【鉄鋼】八幡製鉄所は、日清戦争後の第2次山県有朋内閣期に設立決定されました。" },
                    { id: 4, text: "綿糸の生産高が輸入高を初めて上回った。", isCorrect: false, explanation: "1890年の出来事です。", correction: "「1890年」に上回った。", relatedInfo: "【綿糸】1890年に生産が輸入を上回り、綿糸輸出国への道を歩み始めました。" }
                ]
            },
            {
                id: 18,
                title: "楽市・楽座",
                source: "オリジナル",
                category: "中世",
                questionText: "織田信長が実施した楽市・楽座などの経済政策について述べた文として誤っているものを選べ。",
                options: [
                    { id: 1, text: "座を解体し、商人の自由な営業を認めた。", isCorrect: false, explanation: "正しい。既得権益を持つ座を排除しました。", correction: null, relatedInfo: "【商業】寺社や公家の支配下にあった座を排除し、商工業を活性化させました。" },
                    { id: 2, text: "関所を撤廃し、物資の流通をスムーズにした。", isCorrect: false, explanation: "正しい。関銭の徴収をなくし流通を活性化させました。", correction: null, relatedInfo: "【交通】関所の撤廃は、人や物の往来を自由にしました。" },
                    { id: 3, text: "撰銭令を出し、良銭と悪銭の交換比率を定めた。", isCorrect: false, explanation: "正しい。信長も撰銭令を出しています。", correction: null, relatedInfo: "【貨幣】撰銭令は、取引の円滑化を図るために出されました。" },
                    { id: 4, text: "全国の土地を調査し、石高制を確立した。", isCorrect: true, explanation: "誤りです。石高制を確立した太閤検地を行ったのは「豊臣秀吉」です。", correction: "「豊臣秀吉」が行った。", relatedInfo: "信長は「指出検地（自己申告）」を行いました。" }
                ]
            },
            {
                id: 19,
                title: "荘園公領制",
                source: "オリジナル",
                category: "中世",
                questionText: "平安時代から中世にかけての荘園について述べた文として正しいものを選べ。",
                options: [
                    { id: 1, text: "荘園領主は、不輸・不入の権を得て、国司の干渉を排除しようとした。", isCorrect: true, explanation: "正しい。免税特権（不輸）と検田使立ち入り拒否（不入）を得て自立しました。", correction: null, relatedInfo: "【荘園】寄進地系荘園の発展により、公領（国衙領）を侵食しました。" },
                    { id: 2, text: "名主（みょうしゅ）は、耕作を行わず、荘園の管理のみを行った。", isCorrect: false, explanation: "名主は有力農民であり、下人などを使って耕作経営を行いました。", correction: "耕作経営も行った。", relatedInfo: "【名主】「田堵（たと）」が成長したもので、名の請負人です。" },
                    { id: 3, text: "地頭は、荘園領主から任命され、年貢の徴収を請け負った。", isCorrect: false, explanation: "地頭は「幕府」によって任命されました。", correction: "「幕府」が任命した。", relatedInfo: "承久の乱後、新補地頭が増加し、荘園への侵略が進みました。" },
                    { id: 4, text: "惣村は、荘園領主によって組織された農民の団体である。", isCorrect: false, explanation: "惣村は、農民が自衛・自治のために「自発的」に結合した組織です。", correction: "農民が「自発的」に組織した。", relatedInfo: "寄合を開き、惣掟を定め、地下請（じげうけ）を行うこともありました。" }
                ]
            },
            {
                id: 20,
                title: "バブル経済と崩壊",
                source: "オリジナル",
                category: "現代",
                questionText: "1980年代後半からのバブル経済とその崩壊について述べた文として正しいものを選べ。",
                options: [
                    { id: 1, text: "プラザ合意により、急激な円安が進行した。", isCorrect: false, explanation: "1985年のプラザ合意により、急激な「円高」が進行しました。", correction: "急激な「円高」が進行。", relatedInfo: "円高不況対策としての低金利政策が、過剰流動性を生みバブルの一因となりました。" },
                    { id: 2, text: "地価や株価が投機的に高騰した。", isCorrect: true, explanation: "正しい。実体経済とかけ離れて資産価格が高騰しました。", correction: null, relatedInfo: "【社会問題】地上げ屋による強引な土地買収なども頻発しました。" },
                    { id: 3, text: "消費税が初めて導入されたのは、バブル崩壊後のことである。", isCorrect: false, explanation: "消費税（3%）導入は1989年（竹下登内閣）で、バブル絶頂期です。", correction: "バブル期の「1989年」に導入。", relatedInfo: "【税制】その後、1997年に5%、2014年に8%、2019年に10%へ引き上げられました。" },
                    { id: 4, text: "金融機関の不良債権問題は、速やかに解決された。", isCorrect: false, explanation: "バブル崩壊後、巨額の不良債権処理が長引き、「失われた10年（20年）」の原因となりました。", correction: "処理が「長引いた」。", relatedInfo: "【金融破綻】1997年には山一證券や北海道拓殖銀行が破綻しました。" }
                ]
            }
        ];

        // --- 3. 状態管理 ---
        let state = {
            currentIndex: 0,
            selectedOptionId: null,
            showResult: false,
            quizQuestions: [] // ランダムに選ばれた5問を格納
        };

        // --- 4. ヘルパー関数 ---

        // ランダムに5問選ぶ関数
        function selectRandomQuestions() {
            // 配列のコピーを作成してシャッフル
            const shuffled = [...ALL_QUESTIONS_DATA].sort(() => 0.5 - Math.random());
            // 先頭5つを取得
            return shuffled.slice(0, 5);
        }

        // Explanation CardのHTML生成
        function createExplanationCardHTML(props) {
            const isCorrect = props.status === 'correct';
            const icon = isCorrect ? Icons.CheckCircle() : Icons.XCircle();
            const bgClass = isCorrect ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500';
            const textClass = isCorrect ? 'text-green-600' : 'text-red-600';
            const badgeClass = isCorrect ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800';
            const badgeText = isCorrect ? "正文" : "誤文";

            let html = `
                <div class="mb-4 p-4 rounded-lg border-l-4 ${bgClass}">
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <div class="w-5 h-5 ${textClass}">${icon}</div>
                            <span class="font-bold text-gray-800">${props.label || "選択肢"}</span>
                        </div>
                        <span class="text-xs px-2 py-1 rounded font-bold ${badgeClass}">${badgeText}</span>
                    </div>

                    <p class="text-gray-700 mb-3 font-medium border-b border-gray-200 pb-2">
                        ${props.text}
                    </p>

                    <div class="space-y-3">
                        <div>
                            <h4 class="flex items-center text-sm font-bold text-gray-600 mb-1">
                                <span class="w-4 h-4 mr-1">${Icons.BookOpen()}</span> 解説
                            </h4>
                            <p class="text-sm text-gray-700 leading-relaxed pl-5">${props.explanation}</p>
                        </div>`;

            if (!isCorrect && props.correction) {
                html += `
                    <div>
                        <h4 class="flex items-center text-sm font-bold text-blue-600 mb-1">
                            <span class="w-4 h-4 mr-1">${Icons.RefreshCw()}</span> 正解にするための修正
                        </h4>
                        <div class="text-sm bg-white p-2 rounded border border-blue-100 text-blue-800 font-medium pl-5 shadow-sm flex items-start">
                            <span class="inline-block w-3 h-3 mr-1 mt-1">${Icons.ArrowRight()}</span>
                            <span>${props.correction}</span>
                        </div>
                    </div>`;
            }

            if (props.relatedInfo) {
                html += `
                    <div class="mt-3 pt-2 border-t border-dashed border-gray-300">
                        <h4 class="flex items-center text-xs font-bold text-amber-600 mb-1">
                            <span class="w-3 h-3 mr-1">${Icons.Lightbulb()}</span> 日本史知識の紐付け
                        </h4>
                        <p class="text-xs text-gray-600 pl-4">${props.relatedInfo}</p>
                    </div>`;
            }

            html += `</div></div>`;
            return html;
        }

        // --- 5. メインレンダリング関数 ---
        function render() {
            const app = document.getElementById('app');
            const currentQuestion = state.quizQuestions[state.currentIndex];
            
            // 現在の選択が正解かどうか判定
            let isSelectedCorrect = false;
            let correctOptionIndex = -1;
            
            if (state.selectedOptionId) {
                const option = currentQuestion.options.find(opt => opt.id === state.selectedOptionId);
                isSelectedCorrect = option ? option.isCorrect : false;
                correctOptionIndex = currentQuestion.options.findIndex(o => o.isCorrect);
            }

            // --- HTML構築 ---
            let html = `
                <!-- Header -->
                <header class="mb-6 flex items-center justify-between bg-white p-4 rounded-xl shadow-sm border-b-4 border-indigo-600">
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold text-indigo-900 flex items-center gap-2">
                            <div class="w-8 h-8">${Icons.GraduationCap()}</div>
                            日本史B 社会経済史
                        </h1>
                        <p class="text-sm text-gray-500 mt-1">正誤問題徹底攻略マスター</p>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-1 rounded">
                            問 ${state.currentIndex + 1} / ${state.quizQuestions.length}
                        </span>
                    </div>
                </header>

                <!-- Question Card -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden mb-6">
                    <div class="bg-slate-50 p-4 border-b border-gray-200 flex justify-between items-center">
                        <span class="inline-block px-3 py-1 bg-amber-100 text-amber-800 text-xs font-bold rounded-full border border-amber-200">
                            ${currentQuestion.category}
                        </span>
                        <span class="text-xs text-gray-400 font-mono">ID: ${currentQuestion.source}</span>
                    </div>
                    
                    <div class="p-6">
                        <h2 class="text-lg font-bold mb-4 text-gray-800 leading-relaxed">
                            ${currentQuestion.title}
                        </h2>
                        <p class="mb-6 text-gray-700 leading-7 text-lg">
                            ${currentQuestion.questionText}
                        </p>
                        ${currentQuestion.subText ? `
                            <div class="mb-6 p-4 bg-gray-50 rounded border border-gray-200 text-sm font-serif leading-loose whitespace-pre-line">
                                ${currentQuestion.subText}
                            </div>` : ''
                        }

                        <!-- Options List -->
                        <div class="space-y-3">
            `;

            // 選択肢ボタンの生成
            currentQuestion.options.forEach((option, index) => {
                const optionLabel = ['①','②','③','④'][option.id - 1];
                let btnClass = "w-full text-left p-4 rounded-lg border-2 transition-all duration-200 relative flex items-start gap-3 ";
                let badgeClass = "flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold border ";

                if (state.showResult) {
                    // 結果表示モード
                    if (option.isCorrect) {
                        btnClass += "bg-green-50 border-green-500 text-green-900";
                        badgeClass += "bg-green-500 text-white border-green-500";
                    } else if (state.selectedOptionId === option.id) {
                        btnClass += "bg-red-50 border-red-500 text-red-900";
                        badgeClass += "bg-gray-100 border-gray-300";
                    } else {
                        btnClass += "bg-gray-50 border-gray-200 text-gray-400 opacity-60";
                        badgeClass += "bg-gray-100 border-gray-300";
                    }
                } else {
                    // 入力待ちモード
                    btnClass += "bg-white border-gray-200 hover:border-indigo-400 hover:shadow-md active:bg-indigo-50 text-gray-700 cursor-pointer";
                    badgeClass += "bg-gray-100 border-gray-300";
                }

                // ボタンのHTML (onclickはグローバル関数を呼ぶ)
                const disabledAttr = state.showResult ? 'disabled' : '';
                const clickHandler = state.showResult ? '' : `onclick="handleOptionSelect(${option.id})"`;

                html += `
                    <button class="${btnClass}" ${disabledAttr} ${clickHandler}>
                        <div class="${badgeClass}">${optionLabel}</div>
                        <span class="font-medium">${option.text}</span>
                    </button>
                `;
            });

            html += `   </div>
                    </div>
                </div>`;

            // --- 結果・解説セクション ---
            if (state.showResult) {
                const resultBannerClass = isSelectedCorrect ? 'bg-green-100 border-green-300 text-green-800' : 'bg-red-100 border-red-300 text-red-800';
                const resultIcon = isSelectedCorrect ? Icons.CheckCircle() : Icons.AlertTriangle();
                const resultText = isSelectedCorrect ? '正解！' : '不正解...';
                const correctOptionLabel = ['①','②','③','④'][correctOptionIndex];

                html += `
                    <div class="fade-in-up">
                        <!-- Main Result Banner -->
                        <div class="p-4 rounded-lg text-center mb-6 shadow-sm border ${resultBannerClass}">
                            <div class="flex items-center justify-center gap-2 text-xl font-bold">
                                <div class="w-6 h-6">${resultIcon}</div> ${resultText}
                            </div>
                            ${!isSelectedCorrect ? `<p class="mt-1 text-sm">正しい答えは <strong>選択肢 ${correctOptionLabel}</strong> です。</p>` : ''}
                        </div>

                        <!-- Detailed Analysis -->
                        <div class="bg-white rounded-xl shadow-lg border border-indigo-100 overflow-hidden mb-8">
                            <div class="bg-indigo-50 p-3 border-b border-indigo-100 flex items-center gap-2">
                                <div class="w-5 h-5 text-indigo-600">${Icons.BookOpen()}</div>
                                <h3 class="font-bold text-indigo-900">詳細解説・誤文訂正</h3>
                            </div>
                            
                            <div class="p-4 md:p-6 bg-white">
                                <p class="text-sm text-gray-500 mb-4">
                                    ※誤った選択肢を「どう直せば正解になるか」を確認しましょう。
                                </p>
                `;

                // 解説カードの生成
                if (currentQuestion.detailedBreakdown) {
                    currentQuestion.detailedBreakdown.forEach(item => {
                        html += createExplanationCardHTML(item);
                    });
                } else {
                    currentQuestion.options.forEach(opt => {
                        html += createExplanationCardHTML({
                            label: `選択肢 ${['①','②','③','④'][opt.id - 1]}`,
                            status: opt.isCorrect ? 'correct' : 'incorrect',
                            text: opt.text,
                            explanation: opt.explanation,
                            correction: opt.correction,
                            relatedInfo: opt.relatedInfo
                        });
                    });
                }

                html += `   </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="flex justify-between items-center pb-8 gap-4">
                            <button onclick="prevQuestion()" class="flex-1 px-4 py-3 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold transition flex items-center justify-center gap-2" ${state.currentIndex === 0 ? 'disabled style="opacity:0.5"' : ''}>
                                <div class="w-4 h-4 rotate-90">${Icons.ChevronDown()}</div> 前の問題
                            </button>
                `;
                
                // 最後の問題かどうかでボタンを変える
                if (state.currentIndex < state.quizQuestions.length - 1) {
                    html += `
                            <button onclick="nextQuestion()" class="flex-1 px-4 py-3 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-bold shadow-md transition flex items-center justify-center gap-2">
                                次の問題へ <div class="w-4 h-4">${Icons.ArrowRight()}</div>
                            </button>
                        </div>
                    </div>`;
                } else {
                     html += `
                            <button onclick="resetQuiz()" class="flex-1 px-4 py-3 rounded-lg bg-orange-500 hover:bg-orange-600 text-white font-bold shadow-md transition flex items-center justify-center gap-2">
                                <div class="w-4 h-4">${Icons.Refresh()}</div> 新しい問題に挑戦
                            </button>
                        </div>
                    </div>`;
                }
            }

            // HTMLをDOMに注入
            app.innerHTML = html;
        }

        // --- 6. イベントハンドラ ---
        window.handleOptionSelect = (id) => {
            if (state.showResult) return;
            state.selectedOptionId = id;
            state.showResult = true;
            render();
        };

        window.nextQuestion = () => {
            state.selectedOptionId = null;
            state.showResult = false;
            state.currentIndex = (state.currentIndex + 1);
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.prevQuestion = () => {
            if(state.currentIndex > 0) {
                state.selectedOptionId = null; // 戻ったときに回答状態をリセットするかは仕様によるが、今回はリセット
                state.showResult = false;
                state.currentIndex = (state.currentIndex - 1);
                render();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        };

        window.resetQuiz = () => {
            state.currentIndex = 0;
            state.selectedOptionId = null;
            state.showResult = false;
            state.quizQuestions = selectRandomQuestions();
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- 7. アプリケーション開始 ---
        // 初回ロード時にランダムに問題を選択
        state.quizQuestions = selectRandomQuestions();
        render();

    </script>
</body>
</html>
